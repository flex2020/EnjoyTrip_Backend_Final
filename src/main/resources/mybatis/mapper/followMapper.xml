<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.enjoytrip.follow.model.FollowMapper">

  <insert id="insertFollow">
    INSERT INTO followings (from_member_id, to_member_id)
    SELECT m1.member_id, m2.member_id
    FROM members m1, members m2
    WHERE m1.member_id = #{fromMemberId} AND m2.member_id = #{toMemberId}
  </insert>

  <delete id="deleteFollow">
    DELETE FROM followings
    WHERE from_member_id = (SELECT member_id FROM members WHERE member_id = #{fromMemberId})
    AND to_member_id = (SELECT member_id FROM members WHERE member_id = #{toMemberId})
  </delete>

  <select id="countFollowers" resultType="int">
    SELECT COUNT(*) FROM followings
    WHERE to_member_id = (SELECT member_id FROM members WHERE member_id = #{memberId})
  </select>

  <select id="countFollowees" resultType="int">
    SELECT COUNT(*) FROM followings
    WHERE from_member_id = (SELECT member_id FROM members WHERE member_id = #{memberId})
  </select>
  
  <select id="isFollowing" resultType="boolean">
      SELECT COUNT(*) > 0
      FROM followings
      WHERE from_member_id = #{fromMemberId} AND to_member_id = #{toMemberId}
  </select>

  <select id="isFollowedBy" resultType="boolean">
      SELECT COUNT(*) > 0
      FROM followings
      WHERE from_member_id = #{toMemberId} AND to_member_id = #{fromMemberId}
  </select>

  <select id="getFollowers" resultType="memberDto">
      SELECT m.member_id, m.email, m.member_name, m.nickname
      FROM followings f
      JOIN members m ON f.from_member_id = m.member_id
      WHERE f.to_member_id = #{memberId}
  </select>

  <select id="getFollowees" resultType="memberDto">
      SELECT m.member_id, m.email, m.member_name, m.nickname
      FROM followings f
      JOIN members m ON f.to_member_id = m.member_id
      WHERE f.from_member_id = #{memberId}
  </select>  
  
</mapper>